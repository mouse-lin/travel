<script type="text/javascript" charset="utf-8">
    jQuery(document).ready(function(){
        //其他选择 -- 彬
        $(".search-product").singleTriggle({ 
            children : ["出境跟团游", "国内跟团游", "自由人", "签证"],
            title : '请选择产品类型',
            callback : { 
                click : function (el, value, event) { 
                    $(".search-product").val(value);
                    $("#productS").val(value);
                }
            }
        })

        $(".search-chufa").singleTriggle({ 
            children : [
                "北京", "天津", "沈阳", "石家庄", "青岛", "大连", "太原", "上海"
            ],
            title : '请选择出发地',
            callback : { 
                click : function (el, value, event) { 
                    $(".search-chufa").val(value);
                }
            }
        });

        $(".search-descat").multiTriggle ({ 
            children : [
                { value : "欧洲"      },
                { value : "美洲"      },
                { value : "大洋洲"    },
                { value : "中东非洲"  },
                { value : "东南亚", children : [
                    "泰国", "新加坡", "马来西亚", "菲律宾", "印度尼西亚", "越南", "柬埔寨", "缅甸", "老挝", "文莱",
                    "曼谷", "清迈", "云顶", "沙巴", "槟城", "宿雾", "保和", "巴厘", "兰卡威", "绿中海", "邦咯岛", "芭提雅",
                    "普吉岛", "苏梅岛", "吉隆坡", "波德申", "马尼拉", "长滩岛", "巴拉望", "雅加达", "珍拉丁湾"
                ] },
                { value : "南亚"      },
                { value : "日韩朝鲜"  },
                { value : "马代"      },
                { value : "塞班"      },
                { value : "亚洲其它"  },
                { value : "港澳台"    }
            ],
            title : '请选择目的地',
            callback : {
                save : function (value, event) { 
                    $(".search-descat").val(value);
                }
            }
        });

        $(".search-linetype").singleTriggle ({ 
            children : [ "周边", "特价", "海岛", "亲子", "包机", "蜜月", "自驾", "修学", "专列", "夕阳红", "高尔夫" ],
            select : 'multi',
            title : '请选择路线类型',
            callback : { 
                save : function (value, event) { 
                    $(".search-linetype").val(value);
                }
            }
        });

        
        //表格校验开始
        jGrowl = { open: false };
        jQuery("#formID").validationEngine();

        //日期选择定义
        $("#dateEnd").glDatePicker({
            cssName: "android",
            onChange: function(target, newDate){
                 target.val
                 (
                     newDate.getFullYear() + "-" +
                     (newDate.getMonth() + 1) + "-" +
                     newDate.getDate()
                 );
           }
        });

        $("#dateStart").glDatePicker({
            cssName: "android",
            onChange: function(target, newDate){
                 target.val
                 (
                     newDate.getFullYear() + "-" +
                     (newDate.getMonth() + 1) + "-" +
                     newDate.getDate()
                 );
           }
        });

        quickSearchjGrowl(); 
        //$.Move("quickSearchjGrowlWindow");
    });



    //autocomplete扩展方法
    function autocompleteSearch(dom,url,itemString){
        $(dom).autocomplete(url,{ 
            max:12,
            delay:1,
            dataType: "json",
            parse: function(data) {  
              return $.map(eval(data), function(row) {  
                  return {  
                       data: row,  
                       result: row.name
                    }  
                });
            },  
            formatItem: function(item) {  
                if(!itemString)
                  return   item.name  ;  
                else
                  return itemString;
            },  
        });
    }

    //定义函数
    function initForm(){ 
        //autocomplete定义标签
        autocompleteSearch("#pifaName","/homes/autocomplete_search.json?model=Pifa");
        autocompleteSearch("#lineName","/homes/autocomplete_search.json?model=Linename");
    }

    //查询拖放窗口
    function quickSearchjGrowl(){ 
        /* 前台使用快速搜索代码  --> 复制这里的代码可以随时在html.erb中使用
        <%= form_tag "/homes", :id => "quickSearch", :class => "quickSearch", :method => "get" do %>
        产品分类<font  color="red">*</font>：
        <%=text_field :type, :product, :id =>"productS", :class => "validate[required]", :value => flash[:product_type], :size => 20 %><br>
        线路编号：
        <%=text_field :search, :line_number, :id =>"lineNumber",:value => flash[:line_number], :size => 20 %><br>
        品牌编号：
        <%=text_field :search, :pifa_name, :id =>"pifaName",:value => flash[:pifa_name], :size => 20 %><br>
        <button>确定</button>
        <%end%>
        */

        if(!jGrowl.open){  
            var form_start = '<%= form_tag "/homes"  , :id => "quickSearch", :class => "quickSearch", :method => "get" do %>';
        var product = '<%=text_field :type, :product, :id =>"productS", :class => "validate[required]", :hidden => true, :value => flash[:product_type], :size => 20 %><br>'
            var line_name = '线路名称：<%=text_field :quick_search, :line_name, :id =>"lineName",:value => flash[:line_name], :size => 20 %><br>';
            var line_number = '线路编号：<%=text_field :quick_search, :line_number, :id =>"lineNumber",:value => flash[:line_number], :size => 20 %><br>';
            var pifa_name = '品牌编号：<%=text_field :quick_search, :pifa_name, :id =>"pifaName",:value => flash[:pifa_name], :size => 20 %><br>';
            var button='<button>确定</button>';
            var form_end = '<% end %>';

            var title="快速查询";
            var content_string = form_start +  line_number + line_name + pifa_name + product +  button + form_end;
            return $.jGrowl(content_string,{ 
                sticky: true,
                header: title,
                position: "bottom-right",
                close: function(){ 
                    jGrowl.open = false;
                },
                afterOpen: function(){ 
                    jGrowl.open = true;
                    initForm();
                },
   			   		 nimateOpen: { 
				   		     height: "show",
				   		     width: "show"
				   	   },
            });
        }
    }

</script>

      <div id="quickSearchjGrowlWindow"></div>

<div class="wrapper col3">
  <div id="homecontent">
    <div class="fl_left">
      <div class="column2">
        <ul>
          <li>
            <form id="formID" class="formular" action="">
            <b>详细搜索栏</b><br>
                产品分类<font  color="red">*</font>：<input readonly value=<%= @product_type %> class="validate[required] search-product"  name="product" id="product"></input>
                出发地 ：<input class='search-chufa' type="text" readonly></input>
                目的地：<input class='search-descat' type="text" readonly></input>
                线路类型：<input class='search-linetype' type="text" readonly></input>
                天数：<input type="text" readonly></input>
                价格：<input type="text" readonly></input>
                出团时间起：<input  readonly name="dateStart" id="dateStart"></input>
                出团时间止：<input  readonly name="dateEnd" id="dateEnd"></input>
                <button>高级搜索</button>
            </form>

          </li>
        </ul>
        <br class="clear" />
      </div>



      <div class="column2">
      
      <h2>旅游发团搜索结果</h2>
      <% if @results %>
      <ul>
          <% @search_results.each do |r| %>
        <li>
          <div class="imgholder"><a href="#"><img src="/images/demo/794_s.jpg" alt="" /></a></div>
          <% unless r["visatype_name"]%>
            <b>线路名称 ：</b><strong><a href="#"><%=r["line_name"]%></a></strong><br>
            <b>线路编号 ：</b><%=r["id"]%><br>
            <b>出发地 ：</b><%=r["chufa_name"]%><br>
            <b>品牌名称 ：</b><%=r["pifa_name"]%><br>
            <b>天数 ：</b><%=r["days"]%><br>
            <b>星级 ：</b><%=r["star"]%><br>
            <% if r["foods"] %>
              <b>餐食 ：</b><%=r["foods"] %><br> 
            <% end %>
            <%if r["house_name"]  %>
              <b>酒店类型 ：</b><%=r["house_name"] %><br> 
            <% end %>
            <b>有效期起 ：</b><%=r["daystart"]%><br>
            <b>有效期止 ：</b><%=r["dayend"]%><br>
            <b>总位 ：</b><%=r["total"]%>   <b>剩位 ：</b><font color="red"><%=r["left"]%></font><br>
            <b>出发日期 ：</b><%=r["fatuanri"]%><br>
            <b>同行价 ：</b><%=r["tonghang"]%><br>
            <b>直客价 ：</b><%=r["zhike"]%><br>
            <b>线路说明 ：</b><%=r["detail"]%><br>
          <% else %>
            <b>线路名称 ：</b><strong><a href="#"><%=r["line_name"]%></a></strong><br>
            <b>线路编号 ：</b><%=r["id"]%><br>
            <b>送签地 ：</b><%=r["songqiandi"]%><br>
            <b>送签国 ：</b><%=r["songqianguo"]%><br>
            <b>签证类型 ：</b><%=r["visatype_name"]%><br>
            <b>所需资料 ：</b><%=r["document"]%><br>
            <b>所需时间 ：</b><%=r["days"]%>个工作日<br>
            <b>签证说明 ：</b><%=r["detail"]%><br>
            <b>有效期起 ：</b><%=r["daystart"]%><br>
            <b>有效期止 ：</b><%=r["dayend"]%><br>
            <b>同行价 ：</b><%=r["tonghang"]%><br>
            <b>直客价 ：</b><%=r["zhike"]%><br>
          <% end %>
        </li>
        <% end %>
      </ul>
      <div class="digg_pagination">
        <%= will_paginate @results, :container => false, :param_name => "quick_search_page" %>
      </div>
      <% end %>
      </div>

    </div>

    <div class="fl_right">

    </div>
    <br class="clear" />
  </div>
</div>
<!-- ####################################################################################################### -->
